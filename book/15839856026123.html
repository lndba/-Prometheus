<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  集成钉钉告警 - 深入剖析Prometheus
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="深入剖析Prometheus" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">深入剖析Prometheus</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 深入剖析Prometheus</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>Prometheus简介</label></li>

          
            <li><a title="监控系统概述" href="jian-kong-gai-shuemspemsp-ben.html">监控系统概述</a></li>
          
            <li><a title="Prometheus概述" href="15839814370590.html">Prometheus概述</a></li>
          
            <li><a title="Prometheus组件与架构" href="15839817915948.html">Prometheus组件与架构</a></li>
          
            <li><a title="Prometheus适用场景" href="15839819738320.html">Prometheus适用场景</a></li>
          
            <li><a title="指标的数据模型" href="15839821214979.html">指标的数据模型</a></li>
          
            <li><a title="指标的数据类型" href="15839822589974.html">指标的数据类型</a></li>
          
            <li><a title="任务和实例" href="15839822897749.html">任务和实例</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus的安装与启动</label></li>

          
            <li><a title="Prometheus二进制方式安装" href="15839799784985.html">Prometheus二进制方式安装</a></li>
          
            <li><a title="创建systemd服务单元文件管理prometheus" href="15839825116395.html">创建systemd服务单元文件管理prometheus</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus配置文件详解与主机监控</label></li>

          
            <li><a title="全局配置" href="15839834045191.html">全局配置</a></li>
          
            <li><a title="数据拉取配置" href="15839834296106.html">数据拉取配置</a></li>
          
            <li><a title="label标签的配置与使用" href="15839834564941.html">label标签的配置与使用</a></li>
          
            <li><a title="基于文件服务发现配置" href="15839834811275.html">基于文件服务发现配置</a></li>
          
            <li><a title="通过node_exporter监控Linux主机" href="15839835019093.html">通过node_exporter监控Linux主机</a></li>
          

      
        <li class="divider"></li>
        <li><label>探索PromQL查询</label></li>

          
            <li><a title="初识PromQL" href="15839841002510.html">初识PromQL</a></li>
          
            <li><a title="PromQL常用操作符" href="15839841117016.html">PromQL常用操作符</a></li>
          
            <li><a title="PromQL聚合操作" href="15839841454808.html">PromQL聚合操作</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus监控实践</label></li>

          
            <li><a title="prometheus监控CPU和内存使用率" href="15839841733938.html">prometheus监控CPU和内存使用率</a></li>
          
            <li><a title="prometheus监控磁盘" href="15839841806331.html">prometheus监控磁盘</a></li>
          
            <li><a title="使用Grafana展示Prometheus数据" href="15839841973332.html">使用Grafana展示Prometheus数据</a></li>
          
            <li><a title="使用mysqld_exporter监控MySQL服务" href="15839847659986.html">使用mysqld_exporter监控MySQL服务</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus的远端探测</label></li>

          
            <li><a title="blackbox_exporter介绍" href="15839848579044.html">blackbox_exporter介绍</a></li>
          
            <li><a title="blackbox_exporter配置及使用" href="15839849152297.html">blackbox_exporter配置及使用</a></li>
          
            <li><a title="写一个简单的http探测" href="15839849653881.html">写一个简单的http探测</a></li>
          
            <li><a title="blackbox_exporter使用systemd的方式启动" href="15839850323209.html">blackbox_exporter使用systemd的方式启动</a></li>
          
            <li><a title="在Prometheus下配置blockbox exporter" href="15839850663032.html">在Prometheus下配置blockbox exporter</a></li>
          

      
        <li class="divider"></li>
        <li><label>Pushgateway推送网关</label></li>

          
            <li><a title="Pushgateway介绍" href="15839851263271.html">Pushgateway介绍</a></li>
          
            <li><a title="安装pushgateway" href="15839851679033.html">安装pushgateway</a></li>
          
            <li><a title="pushgateway结合自定义脚本监控" href="15839852038668.html">pushgateway结合自定义脚本监控</a></li>
          
            <li><a title="pushgateway与prometheus结合使用" href="15839852459628.html">pushgateway与prometheus结合使用</a></li>
          

      
        <li class="divider"></li>
        <li><label>Alertmanager告警管理器</label></li>

          
            <li><a title="Alertmanager介绍" href="15839852800110.html">Alertmanager介绍</a></li>
          
            <li><a title="部署Alertmanager" href="15839852993088.html">部署Alertmanager</a></li>
          
            <li><a title="Prometheus告警配置和规则配置" href="15839854412649.html">Prometheus告警配置和规则配置</a></li>
          
            <li><a title="集成邮件告警" href="15839854641901.html">集成邮件告警</a></li>
          
            <li><a title="集成企业微信告警" href="15839855043197.html">集成企业微信告警</a></li>
          
            <li><a title="集成钉钉告警" href="15839856026123.html">集成钉钉告警</a></li>
          
            <li><a title="告警分组、抑制、静默" href="15839856905581.html">告警分组、抑制、静默</a></li>
          
            <li><a title="实战告警规则案例" href="15839857094920.html">实战告警规则案例</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>Prometheus简介</span></li>
                        
                          <li><a title="监控系统概述" href="jian-kong-gai-shuemspemsp-ben.html">监控系统概述</a></li>
                        
                          <li><a title="Prometheus概述" href="15839814370590.html">Prometheus概述</a></li>
                        
                          <li><a title="Prometheus组件与架构" href="15839817915948.html">Prometheus组件与架构</a></li>
                        
                          <li><a title="Prometheus适用场景" href="15839819738320.html">Prometheus适用场景</a></li>
                        
                          <li><a title="指标的数据模型" href="15839821214979.html">指标的数据模型</a></li>
                        
                          <li><a title="指标的数据类型" href="15839822589974.html">指标的数据类型</a></li>
                        
                          <li><a title="任务和实例" href="15839822897749.html">任务和实例</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus的安装与启动</span></li>
                        
                          <li><a title="Prometheus二进制方式安装" href="15839799784985.html">Prometheus二进制方式安装</a></li>
                        
                          <li><a title="创建systemd服务单元文件管理prometheus" href="15839825116395.html">创建systemd服务单元文件管理prometheus</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus配置文件详解与主机监控</span></li>
                        
                          <li><a title="全局配置" href="15839834045191.html">全局配置</a></li>
                        
                          <li><a title="数据拉取配置" href="15839834296106.html">数据拉取配置</a></li>
                        
                          <li><a title="label标签的配置与使用" href="15839834564941.html">label标签的配置与使用</a></li>
                        
                          <li><a title="基于文件服务发现配置" href="15839834811275.html">基于文件服务发现配置</a></li>
                        
                          <li><a title="通过node_exporter监控Linux主机" href="15839835019093.html">通过node_exporter监控Linux主机</a></li>
                        

                    
                      <li class="side-title"><span>探索PromQL查询</span></li>
                        
                          <li><a title="初识PromQL" href="15839841002510.html">初识PromQL</a></li>
                        
                          <li><a title="PromQL常用操作符" href="15839841117016.html">PromQL常用操作符</a></li>
                        
                          <li><a title="PromQL聚合操作" href="15839841454808.html">PromQL聚合操作</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus监控实践</span></li>
                        
                          <li><a title="prometheus监控CPU和内存使用率" href="15839841733938.html">prometheus监控CPU和内存使用率</a></li>
                        
                          <li><a title="prometheus监控磁盘" href="15839841806331.html">prometheus监控磁盘</a></li>
                        
                          <li><a title="使用Grafana展示Prometheus数据" href="15839841973332.html">使用Grafana展示Prometheus数据</a></li>
                        
                          <li><a title="使用mysqld_exporter监控MySQL服务" href="15839847659986.html">使用mysqld_exporter监控MySQL服务</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus的远端探测</span></li>
                        
                          <li><a title="blackbox_exporter介绍" href="15839848579044.html">blackbox_exporter介绍</a></li>
                        
                          <li><a title="blackbox_exporter配置及使用" href="15839849152297.html">blackbox_exporter配置及使用</a></li>
                        
                          <li><a title="写一个简单的http探测" href="15839849653881.html">写一个简单的http探测</a></li>
                        
                          <li><a title="blackbox_exporter使用systemd的方式启动" href="15839850323209.html">blackbox_exporter使用systemd的方式启动</a></li>
                        
                          <li><a title="在Prometheus下配置blockbox exporter" href="15839850663032.html">在Prometheus下配置blockbox exporter</a></li>
                        

                    
                      <li class="side-title"><span>Pushgateway推送网关</span></li>
                        
                          <li><a title="Pushgateway介绍" href="15839851263271.html">Pushgateway介绍</a></li>
                        
                          <li><a title="安装pushgateway" href="15839851679033.html">安装pushgateway</a></li>
                        
                          <li><a title="pushgateway结合自定义脚本监控" href="15839852038668.html">pushgateway结合自定义脚本监控</a></li>
                        
                          <li><a title="pushgateway与prometheus结合使用" href="15839852459628.html">pushgateway与prometheus结合使用</a></li>
                        

                    
                      <li class="side-title"><span>Alertmanager告警管理器</span></li>
                        
                          <li><a title="Alertmanager介绍" href="15839852800110.html">Alertmanager介绍</a></li>
                        
                          <li><a title="部署Alertmanager" href="15839852993088.html">部署Alertmanager</a></li>
                        
                          <li><a title="Prometheus告警配置和规则配置" href="15839854412649.html">Prometheus告警配置和规则配置</a></li>
                        
                          <li><a title="集成邮件告警" href="15839854641901.html">集成邮件告警</a></li>
                        
                          <li><a title="集成企业微信告警" href="15839855043197.html">集成企业微信告警</a></li>
                        
                          <li><a title="集成钉钉告警" href="15839856026123.html">集成钉钉告警</a></li>
                        
                          <li><a title="告警分组、抑制、静默" href="15839856905581.html">告警分组、抑制、静默</a></li>
                        
                          <li><a title="实战告警规则案例" href="15839857094920.html">实战告警规则案例</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>集成钉钉告警</h1>

<p>在某些情况下除了Alertmanager已经内置的集中告警通知方式以外，对于不同的用户和组织而言还需要一些自定义的告知方式支持。通过Alertmanager提供的webhook支持可以轻松实现这一类的扩展。除了用于支持额外的通知方式，webhook还可以与其他第三方系统集成实现运维自动化，或者弹性伸缩等。</p>

<h2 id="toc_0">安装alertmanaer-dingtalk-webhook</h2>

<p>Alertmanager的告警通知转发到钉钉平台，需要下载prometheus-webhook-dingtalk，github地址：<a href="https://github.com/yunlzheng/alertmanaer-dingtalk-webhook">https://github.com/yunlzheng/alertmanaer-dingtalk-webhook</a></p>

<pre><code class="language-text">#下载prometheus-webhook-dingtalk
[root@prometheus-server ~]# cd /usr/local/src/
[root@prometheus-server src]# wget https://github.com/timonwong/prometheus-webhook-dingtalk/releases/download/v1.4.0/prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz

#解压
[root@prometheus-server src]# tar zxvf prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz

#将解压后的目录移动到/usr/local/目录下
[root@prometheus-server src]# mv prometheus-webhook-dingtalk-1.4.0.linux-amd64 /usr/local/prometheus-webhook-dingtalk
[root@prometheus-server src]# cd /usr/local/prometheus-webhook-dingtalk

#查看命令帮助
[root@prometheus-server prometheus-webhook-dingtalk]# ./prometheus-webhook-dingtalk --help

#编辑配置文件
[root@prometheus-server prometheus-webhook-dingtalk]# vim config.yml
targets:
  webhook1:
    url: https://oapi.dingtalk.com/robot/send?access_token=7e221b1218ee788fa491b47a7bf48062d6d46694c2e6bd5251a2098bcf339507
    secret: SEC7549771bddc453e552ef4b4ace7b8a65f0e4fae06331dd017fff4fe23d4bd494

#手动启动
[root@prometheus-server prometheus-webhook-dingtalk]# ./prometheus-webhook-dingtalk --config.file=&quot;config.yml&quot;
</code></pre>

<h2 id="toc_1">创建systemd服务单元文件管理prometheus-webhook-dingtalk</h2>

<pre><code class="language-text">[root@prometheus-server prometheus-webhook-dingtalk]# cat &gt; /usr/lib/systemd/system/prometheus-webhook-dingtalk.service &lt;&lt; &#39;EOF&#39;
[Unit]
Description=prometheus-webhook-dingtalk
Wants=network-online.target
After=network-online.target

[Service]
ExecStart=/usr/local/prometheus-webhook-dingtalk/prometheus-webhook-dingtalk \
    --config.file=/usr/local/prometheus-webhook-dingtalk/config.yml \
    --web.listen-address=&quot;:8060&quot;

[Install]
WantedBy=default.target
EOF

#启动prometheus-webhook-dingtalk
[root@prometheus-server prometheus-webhook-dingtalk]# systemctl daemon-reload
[root@prometheus-server prometheus-webhook-dingtalk]# systemctl start prometheus-webhook-dingtalk.service
[root@prometheus-server prometheus-webhook-dingtalk]# systemctl status prometheus-webhook-dingtalk.service
[root@prometheus-server prometheus-webhook-dingtalk]# systemctl enable prometheus-webhook-dingtalk.service 
</code></pre>

<p>编辑alertmanager.yml文件：</p>

<pre><code class="language-text">global:
  resolve_timeout: 5m

route:
  group_by: [&#39;alertname&#39;]
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1m
  receiver: &#39;dingtalk&#39;
receivers:
- name: &#39;dingtalk&#39;
  webhook_configs:
  - url: http://127.0.0.1:8060/dingtalk/webhook1/send
    send_resolved: true
inhibit_rules:
  - source_match:
      severity: &#39;critical&#39;
    target_match:
      severity: &#39;warning&#39;
    equal: [&#39;alertname&#39;, &#39;dev&#39;, &#39;instance&#39;]
</code></pre>

<p>重启alertmanager：</p>

<pre><code class="language-text">#检查alertmanager.yml文件语法
[root@prometheus-server alertmanager]# ./amtool check-config ./alertmanager.yml

#重启alertmanager
[root@prometheus-server alertmanager]# systemctl restart alertmanager.service
</code></pre>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15839855043197.html"  title="Previous Post: 集成企业微信告警">&laquo; 集成企业微信告警</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15839856905581.html" 
	        title="Next Post: 告警分组、抑制、静默">告警分组、抑制、静默 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15839856026123.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
