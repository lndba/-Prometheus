<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Prometheus告警配置和规则配置 - 深入剖析Prometheus
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="深入剖析Prometheus" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">深入剖析Prometheus</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 深入剖析Prometheus</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>Prometheus简介</label></li>

          
            <li><a title="监控系统概述" href="jian-kong-gai-shuemspemsp-ben.html">监控系统概述</a></li>
          
            <li><a title="Prometheus概述" href="15839814370590.html">Prometheus概述</a></li>
          
            <li><a title="Prometheus组件与架构" href="15839817915948.html">Prometheus组件与架构</a></li>
          
            <li><a title="Prometheus适用场景" href="15839819738320.html">Prometheus适用场景</a></li>
          
            <li><a title="指标的数据模型" href="15839821214979.html">指标的数据模型</a></li>
          
            <li><a title="指标的数据类型" href="15839822589974.html">指标的数据类型</a></li>
          
            <li><a title="任务和实例" href="15839822897749.html">任务和实例</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus的安装与启动</label></li>

          
            <li><a title="Prometheus二进制方式安装" href="15839799784985.html">Prometheus二进制方式安装</a></li>
          
            <li><a title="创建systemd服务单元文件管理prometheus" href="15839825116395.html">创建systemd服务单元文件管理prometheus</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus配置文件详解与主机监控</label></li>

          
            <li><a title="全局配置" href="15839834045191.html">全局配置</a></li>
          
            <li><a title="数据拉取配置" href="15839834296106.html">数据拉取配置</a></li>
          
            <li><a title="label标签的配置与使用" href="15839834564941.html">label标签的配置与使用</a></li>
          
            <li><a title="基于文件服务发现配置" href="15839834811275.html">基于文件服务发现配置</a></li>
          
            <li><a title="通过node_exporter监控Linux主机" href="15839835019093.html">通过node_exporter监控Linux主机</a></li>
          

      
        <li class="divider"></li>
        <li><label>探索PromQL查询</label></li>

          
            <li><a title="初识PromQL" href="15839841002510.html">初识PromQL</a></li>
          
            <li><a title="PromQL常用操作符" href="15839841117016.html">PromQL常用操作符</a></li>
          
            <li><a title="PromQL聚合操作" href="15839841454808.html">PromQL聚合操作</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus监控实践</label></li>

          
            <li><a title="prometheus监控CPU和内存使用率" href="15839841733938.html">prometheus监控CPU和内存使用率</a></li>
          
            <li><a title="prometheus监控磁盘" href="15839841806331.html">prometheus监控磁盘</a></li>
          
            <li><a title="使用Grafana展示Prometheus数据" href="15839841973332.html">使用Grafana展示Prometheus数据</a></li>
          
            <li><a title="使用mysqld_exporter监控MySQL服务" href="15839847659986.html">使用mysqld_exporter监控MySQL服务</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus的远端探测</label></li>

          
            <li><a title="blackbox_exporter介绍" href="15839848579044.html">blackbox_exporter介绍</a></li>
          
            <li><a title="blackbox_exporter配置及使用" href="15839849152297.html">blackbox_exporter配置及使用</a></li>
          
            <li><a title="写一个简单的http探测" href="15839849653881.html">写一个简单的http探测</a></li>
          
            <li><a title="blackbox_exporter使用systemd的方式启动" href="15839850323209.html">blackbox_exporter使用systemd的方式启动</a></li>
          
            <li><a title="在Prometheus下配置blockbox exporter" href="15839850663032.html">在Prometheus下配置blockbox exporter</a></li>
          

      
        <li class="divider"></li>
        <li><label>Pushgateway推送网关</label></li>

          
            <li><a title="Pushgateway介绍" href="15839851263271.html">Pushgateway介绍</a></li>
          
            <li><a title="安装pushgateway" href="15839851679033.html">安装pushgateway</a></li>
          
            <li><a title="pushgateway结合自定义脚本监控" href="15839852038668.html">pushgateway结合自定义脚本监控</a></li>
          
            <li><a title="pushgateway与prometheus结合使用" href="15839852459628.html">pushgateway与prometheus结合使用</a></li>
          

      
        <li class="divider"></li>
        <li><label>Alertmanager告警管理器</label></li>

          
            <li><a title="Alertmanager介绍" href="15839852800110.html">Alertmanager介绍</a></li>
          
            <li><a title="部署Alertmanager" href="15839852993088.html">部署Alertmanager</a></li>
          
            <li><a title="Prometheus告警配置和规则配置" href="15839854412649.html">Prometheus告警配置和规则配置</a></li>
          
            <li><a title="集成邮件告警" href="15839854641901.html">集成邮件告警</a></li>
          
            <li><a title="集成企业微信告警" href="15839855043197.html">集成企业微信告警</a></li>
          
            <li><a title="集成钉钉告警" href="15839856026123.html">集成钉钉告警</a></li>
          
            <li><a title="告警分组、抑制、静默" href="15839856905581.html">告警分组、抑制、静默</a></li>
          
            <li><a title="实战告警规则案例" href="15839857094920.html">实战告警规则案例</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>Prometheus简介</span></li>
                        
                          <li><a title="监控系统概述" href="jian-kong-gai-shuemspemsp-ben.html">监控系统概述</a></li>
                        
                          <li><a title="Prometheus概述" href="15839814370590.html">Prometheus概述</a></li>
                        
                          <li><a title="Prometheus组件与架构" href="15839817915948.html">Prometheus组件与架构</a></li>
                        
                          <li><a title="Prometheus适用场景" href="15839819738320.html">Prometheus适用场景</a></li>
                        
                          <li><a title="指标的数据模型" href="15839821214979.html">指标的数据模型</a></li>
                        
                          <li><a title="指标的数据类型" href="15839822589974.html">指标的数据类型</a></li>
                        
                          <li><a title="任务和实例" href="15839822897749.html">任务和实例</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus的安装与启动</span></li>
                        
                          <li><a title="Prometheus二进制方式安装" href="15839799784985.html">Prometheus二进制方式安装</a></li>
                        
                          <li><a title="创建systemd服务单元文件管理prometheus" href="15839825116395.html">创建systemd服务单元文件管理prometheus</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus配置文件详解与主机监控</span></li>
                        
                          <li><a title="全局配置" href="15839834045191.html">全局配置</a></li>
                        
                          <li><a title="数据拉取配置" href="15839834296106.html">数据拉取配置</a></li>
                        
                          <li><a title="label标签的配置与使用" href="15839834564941.html">label标签的配置与使用</a></li>
                        
                          <li><a title="基于文件服务发现配置" href="15839834811275.html">基于文件服务发现配置</a></li>
                        
                          <li><a title="通过node_exporter监控Linux主机" href="15839835019093.html">通过node_exporter监控Linux主机</a></li>
                        

                    
                      <li class="side-title"><span>探索PromQL查询</span></li>
                        
                          <li><a title="初识PromQL" href="15839841002510.html">初识PromQL</a></li>
                        
                          <li><a title="PromQL常用操作符" href="15839841117016.html">PromQL常用操作符</a></li>
                        
                          <li><a title="PromQL聚合操作" href="15839841454808.html">PromQL聚合操作</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus监控实践</span></li>
                        
                          <li><a title="prometheus监控CPU和内存使用率" href="15839841733938.html">prometheus监控CPU和内存使用率</a></li>
                        
                          <li><a title="prometheus监控磁盘" href="15839841806331.html">prometheus监控磁盘</a></li>
                        
                          <li><a title="使用Grafana展示Prometheus数据" href="15839841973332.html">使用Grafana展示Prometheus数据</a></li>
                        
                          <li><a title="使用mysqld_exporter监控MySQL服务" href="15839847659986.html">使用mysqld_exporter监控MySQL服务</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus的远端探测</span></li>
                        
                          <li><a title="blackbox_exporter介绍" href="15839848579044.html">blackbox_exporter介绍</a></li>
                        
                          <li><a title="blackbox_exporter配置及使用" href="15839849152297.html">blackbox_exporter配置及使用</a></li>
                        
                          <li><a title="写一个简单的http探测" href="15839849653881.html">写一个简单的http探测</a></li>
                        
                          <li><a title="blackbox_exporter使用systemd的方式启动" href="15839850323209.html">blackbox_exporter使用systemd的方式启动</a></li>
                        
                          <li><a title="在Prometheus下配置blockbox exporter" href="15839850663032.html">在Prometheus下配置blockbox exporter</a></li>
                        

                    
                      <li class="side-title"><span>Pushgateway推送网关</span></li>
                        
                          <li><a title="Pushgateway介绍" href="15839851263271.html">Pushgateway介绍</a></li>
                        
                          <li><a title="安装pushgateway" href="15839851679033.html">安装pushgateway</a></li>
                        
                          <li><a title="pushgateway结合自定义脚本监控" href="15839852038668.html">pushgateway结合自定义脚本监控</a></li>
                        
                          <li><a title="pushgateway与prometheus结合使用" href="15839852459628.html">pushgateway与prometheus结合使用</a></li>
                        

                    
                      <li class="side-title"><span>Alertmanager告警管理器</span></li>
                        
                          <li><a title="Alertmanager介绍" href="15839852800110.html">Alertmanager介绍</a></li>
                        
                          <li><a title="部署Alertmanager" href="15839852993088.html">部署Alertmanager</a></li>
                        
                          <li><a title="Prometheus告警配置和规则配置" href="15839854412649.html">Prometheus告警配置和规则配置</a></li>
                        
                          <li><a title="集成邮件告警" href="15839854641901.html">集成邮件告警</a></li>
                        
                          <li><a title="集成企业微信告警" href="15839855043197.html">集成企业微信告警</a></li>
                        
                          <li><a title="集成钉钉告警" href="15839856026123.html">集成钉钉告警</a></li>
                        
                          <li><a title="告警分组、抑制、静默" href="15839856905581.html">告警分组、抑制、静默</a></li>
                        
                          <li><a title="实战告警规则案例" href="15839857094920.html">实战告警规则案例</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>Prometheus告警配置和规则配置</h1>

<p>告警配置，编辑prometheus.yml配置文件：</p>

<pre><code class="language-text">alerting: #关联alertmanager
  alertmanagers:
  - static_configs:
    - targets:
       - 127.0.0.1:9093 #alertmanager地址
</code></pre>

<p>告警规则配置，编辑prometheus.yml配置文件：</p>

<pre><code class="language-text">rule_files: #定义告警规则文件
  - &quot;rules/node_rules.yml&quot;
</code></pre>

<p>编写告警规则文件：</p>

<pre><code class="language-text">[root@prometheus-server prometheus]# mkdir rules
[root@prometheus-server prometheus]# vim rules/node_rules.yml
groups:
- name: example
  rules:

  # Alert for any instance that is unreachable for &gt;5 minutes.
  - alert: InstanceDown #告警规则的名称
    expr: up == 0 #基于PromQL表达式告警触发条件
    for: 1m #告警评估等待时间
    labels:
      severity: Error
    annotations: #描述告警详细信息
      summary: &quot;实例：{{ $labels.instance }} 停止工作&quot;
      description: &quot;实例：{{ $labels.instance }} job：{{ $labels.job }}已经停止1分钟以上，请及时处理！&quot;
</code></pre>

<p>重新加载Prometheus服务：</p>

<pre><code class="language-text">#检查prometheus.yml文件语法
[root@prometheus-server prometheus]# ./promtool check config ./prometheus.yml

#重新加载prometheus服务
[root@prometheus-server prometheus]# systemctl reload prometheus.service
</code></pre>

<p>访问Prometheus的alert：<a href="http://192.168.3.11:9090/alerts%E3%80%82">http://192.168.3.11:9090/alerts。</a></p>

<p>Prometheus Alert 告警状态，有三种状态：Inactive、Pending、Firing。</p>

<ul>
<li>Inactive：非活动状态，表示正在监控，但是还未有任何警报触发。</li>
<li>Pending：表示这个警报已经被触发。由于警报可以被分组、压抑/抑制或静默/静音，所以等待评估，过了评估等待时间，则将转到 Firing 状态。</li>
<li>Firing：将警报发送到 AlertManager，它将按照配置将警报的发送给所有接收者。一旦警报解除，则将状态转到 Inactive，如此循环。</li>
</ul>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15839852993088.html"  title="Previous Post: 部署Alertmanager">&laquo; 部署Alertmanager</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15839854641901.html" 
	        title="Next Post: 集成邮件告警">集成邮件告警 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15839854412649.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
