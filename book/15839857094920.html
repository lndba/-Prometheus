<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  实战告警规则案例 - 深入剖析Prometheus
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="深入剖析Prometheus" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">深入剖析Prometheus</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 深入剖析Prometheus</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>Prometheus简介</label></li>

          
            <li><a title="监控系统概述" href="jian-kong-gai-shuemspemsp-ben.html">监控系统概述</a></li>
          
            <li><a title="Prometheus概述" href="15839814370590.html">Prometheus概述</a></li>
          
            <li><a title="Prometheus组件与架构" href="15839817915948.html">Prometheus组件与架构</a></li>
          
            <li><a title="Prometheus适用场景" href="15839819738320.html">Prometheus适用场景</a></li>
          
            <li><a title="指标的数据模型" href="15839821214979.html">指标的数据模型</a></li>
          
            <li><a title="指标的数据类型" href="15839822589974.html">指标的数据类型</a></li>
          
            <li><a title="任务和实例" href="15839822897749.html">任务和实例</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus的安装与启动</label></li>

          
            <li><a title="Prometheus二进制方式安装" href="15839799784985.html">Prometheus二进制方式安装</a></li>
          
            <li><a title="创建systemd服务单元文件管理prometheus" href="15839825116395.html">创建systemd服务单元文件管理prometheus</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus配置文件详解与主机监控</label></li>

          
            <li><a title="全局配置" href="15839834045191.html">全局配置</a></li>
          
            <li><a title="数据拉取配置" href="15839834296106.html">数据拉取配置</a></li>
          
            <li><a title="label标签的配置与使用" href="15839834564941.html">label标签的配置与使用</a></li>
          
            <li><a title="基于文件服务发现配置" href="15839834811275.html">基于文件服务发现配置</a></li>
          
            <li><a title="通过node_exporter监控Linux主机" href="15839835019093.html">通过node_exporter监控Linux主机</a></li>
          

      
        <li class="divider"></li>
        <li><label>探索PromQL查询</label></li>

          
            <li><a title="初识PromQL" href="15839841002510.html">初识PromQL</a></li>
          
            <li><a title="PromQL常用操作符" href="15839841117016.html">PromQL常用操作符</a></li>
          
            <li><a title="PromQL聚合操作" href="15839841454808.html">PromQL聚合操作</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus监控实践</label></li>

          
            <li><a title="prometheus监控CPU和内存使用率" href="15839841733938.html">prometheus监控CPU和内存使用率</a></li>
          
            <li><a title="prometheus监控磁盘" href="15839841806331.html">prometheus监控磁盘</a></li>
          
            <li><a title="使用Grafana展示Prometheus数据" href="15839841973332.html">使用Grafana展示Prometheus数据</a></li>
          
            <li><a title="使用mysqld_exporter监控MySQL服务" href="15839847659986.html">使用mysqld_exporter监控MySQL服务</a></li>
          

      
        <li class="divider"></li>
        <li><label>Prometheus的远端探测</label></li>

          
            <li><a title="blackbox_exporter介绍" href="15839848579044.html">blackbox_exporter介绍</a></li>
          
            <li><a title="blackbox_exporter配置及使用" href="15839849152297.html">blackbox_exporter配置及使用</a></li>
          
            <li><a title="写一个简单的http探测" href="15839849653881.html">写一个简单的http探测</a></li>
          
            <li><a title="blackbox_exporter使用systemd的方式启动" href="15839850323209.html">blackbox_exporter使用systemd的方式启动</a></li>
          
            <li><a title="在Prometheus下配置blockbox exporter" href="15839850663032.html">在Prometheus下配置blockbox exporter</a></li>
          

      
        <li class="divider"></li>
        <li><label>Pushgateway推送网关</label></li>

          
            <li><a title="Pushgateway介绍" href="15839851263271.html">Pushgateway介绍</a></li>
          
            <li><a title="安装pushgateway" href="15839851679033.html">安装pushgateway</a></li>
          
            <li><a title="pushgateway结合自定义脚本监控" href="15839852038668.html">pushgateway结合自定义脚本监控</a></li>
          
            <li><a title="pushgateway与prometheus结合使用" href="15839852459628.html">pushgateway与prometheus结合使用</a></li>
          

      
        <li class="divider"></li>
        <li><label>Alertmanager告警管理器</label></li>

          
            <li><a title="Alertmanager介绍" href="15839852800110.html">Alertmanager介绍</a></li>
          
            <li><a title="部署Alertmanager" href="15839852993088.html">部署Alertmanager</a></li>
          
            <li><a title="Prometheus告警配置和规则配置" href="15839854412649.html">Prometheus告警配置和规则配置</a></li>
          
            <li><a title="集成邮件告警" href="15839854641901.html">集成邮件告警</a></li>
          
            <li><a title="集成企业微信告警" href="15839855043197.html">集成企业微信告警</a></li>
          
            <li><a title="集成钉钉告警" href="15839856026123.html">集成钉钉告警</a></li>
          
            <li><a title="告警分组、抑制、静默" href="15839856905581.html">告警分组、抑制、静默</a></li>
          
            <li><a title="实战告警规则案例" href="15839857094920.html">实战告警规则案例</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>Prometheus简介</span></li>
                        
                          <li><a title="监控系统概述" href="jian-kong-gai-shuemspemsp-ben.html">监控系统概述</a></li>
                        
                          <li><a title="Prometheus概述" href="15839814370590.html">Prometheus概述</a></li>
                        
                          <li><a title="Prometheus组件与架构" href="15839817915948.html">Prometheus组件与架构</a></li>
                        
                          <li><a title="Prometheus适用场景" href="15839819738320.html">Prometheus适用场景</a></li>
                        
                          <li><a title="指标的数据模型" href="15839821214979.html">指标的数据模型</a></li>
                        
                          <li><a title="指标的数据类型" href="15839822589974.html">指标的数据类型</a></li>
                        
                          <li><a title="任务和实例" href="15839822897749.html">任务和实例</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus的安装与启动</span></li>
                        
                          <li><a title="Prometheus二进制方式安装" href="15839799784985.html">Prometheus二进制方式安装</a></li>
                        
                          <li><a title="创建systemd服务单元文件管理prometheus" href="15839825116395.html">创建systemd服务单元文件管理prometheus</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus配置文件详解与主机监控</span></li>
                        
                          <li><a title="全局配置" href="15839834045191.html">全局配置</a></li>
                        
                          <li><a title="数据拉取配置" href="15839834296106.html">数据拉取配置</a></li>
                        
                          <li><a title="label标签的配置与使用" href="15839834564941.html">label标签的配置与使用</a></li>
                        
                          <li><a title="基于文件服务发现配置" href="15839834811275.html">基于文件服务发现配置</a></li>
                        
                          <li><a title="通过node_exporter监控Linux主机" href="15839835019093.html">通过node_exporter监控Linux主机</a></li>
                        

                    
                      <li class="side-title"><span>探索PromQL查询</span></li>
                        
                          <li><a title="初识PromQL" href="15839841002510.html">初识PromQL</a></li>
                        
                          <li><a title="PromQL常用操作符" href="15839841117016.html">PromQL常用操作符</a></li>
                        
                          <li><a title="PromQL聚合操作" href="15839841454808.html">PromQL聚合操作</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus监控实践</span></li>
                        
                          <li><a title="prometheus监控CPU和内存使用率" href="15839841733938.html">prometheus监控CPU和内存使用率</a></li>
                        
                          <li><a title="prometheus监控磁盘" href="15839841806331.html">prometheus监控磁盘</a></li>
                        
                          <li><a title="使用Grafana展示Prometheus数据" href="15839841973332.html">使用Grafana展示Prometheus数据</a></li>
                        
                          <li><a title="使用mysqld_exporter监控MySQL服务" href="15839847659986.html">使用mysqld_exporter监控MySQL服务</a></li>
                        

                    
                      <li class="side-title"><span>Prometheus的远端探测</span></li>
                        
                          <li><a title="blackbox_exporter介绍" href="15839848579044.html">blackbox_exporter介绍</a></li>
                        
                          <li><a title="blackbox_exporter配置及使用" href="15839849152297.html">blackbox_exporter配置及使用</a></li>
                        
                          <li><a title="写一个简单的http探测" href="15839849653881.html">写一个简单的http探测</a></li>
                        
                          <li><a title="blackbox_exporter使用systemd的方式启动" href="15839850323209.html">blackbox_exporter使用systemd的方式启动</a></li>
                        
                          <li><a title="在Prometheus下配置blockbox exporter" href="15839850663032.html">在Prometheus下配置blockbox exporter</a></li>
                        

                    
                      <li class="side-title"><span>Pushgateway推送网关</span></li>
                        
                          <li><a title="Pushgateway介绍" href="15839851263271.html">Pushgateway介绍</a></li>
                        
                          <li><a title="安装pushgateway" href="15839851679033.html">安装pushgateway</a></li>
                        
                          <li><a title="pushgateway结合自定义脚本监控" href="15839852038668.html">pushgateway结合自定义脚本监控</a></li>
                        
                          <li><a title="pushgateway与prometheus结合使用" href="15839852459628.html">pushgateway与prometheus结合使用</a></li>
                        

                    
                      <li class="side-title"><span>Alertmanager告警管理器</span></li>
                        
                          <li><a title="Alertmanager介绍" href="15839852800110.html">Alertmanager介绍</a></li>
                        
                          <li><a title="部署Alertmanager" href="15839852993088.html">部署Alertmanager</a></li>
                        
                          <li><a title="Prometheus告警配置和规则配置" href="15839854412649.html">Prometheus告警配置和规则配置</a></li>
                        
                          <li><a title="集成邮件告警" href="15839854641901.html">集成邮件告警</a></li>
                        
                          <li><a title="集成企业微信告警" href="15839855043197.html">集成企业微信告警</a></li>
                        
                          <li><a title="集成钉钉告警" href="15839856026123.html">集成钉钉告警</a></li>
                        
                          <li><a title="告警分组、抑制、静默" href="15839856905581.html">告警分组、抑制、静默</a></li>
                        
                          <li><a title="实战告警规则案例" href="15839857094920.html">实战告警规则案例</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>实战告警规则案例</h1>

<pre><code class="language-text">[root@prometheus-server rules]# cat node_rules.yml
groups:
- name: node_exporter
  rules:
  # 主机状态
  - alert: node-exporter-down
    expr: up{job=&quot;linux-node&quot;} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: &quot;instance: {{ $labels.instance }} 宕机了&quot;
      description: &quot;instance: {{ $labels.instance }} \n - job: {{ $labels.job }} 关机了， 时间已经1分钟了。&quot;

  # CPU使用率高于90%
  - alert: node-exporter-cpu-high
    expr: (1 - avg(irate(node_cpu_seconds_total{mode=&quot;idle&quot;}[5m])) by(instance,job)) * 100 &gt; 90
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: &quot;instance: {{ $labels.instance }} CPU使用率高于90%&quot;
      description: &quot;instance: {{ $labels.instance }} \n - job: {{ $labels.job }} CPU使用率大于90% (当前值：{{ $value }})&quot;

  # 内存使用率高于90%
  - alert: node-exporter-memory-high
    expr: (1- (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 &gt; 90
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: &quot;instance: {{ $labels.instance }} 内存使用率高于90%&quot;
      description: &quot;instance: {{ $labels.instance }} \n - job: {{ $labels.job }} 内存使用率大于90% (当前值：{{ $value }})&quot;

  # 磁盘使用率高于90%
  - alert: node-exporter-disk-high
    expr: (1 - node_filesystem_free_bytes{fstype=~&quot;xfs|ext4&quot;} / node_filesystem_size_bytes{fstype=~&quot;xfs|ext4&quot;}) * 100 &gt; 90
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: &quot;instance: {{ $labels.instance }} : {{ $labels.mountpoint }} 分区使用率高于90%&quot;
      description: &quot;instance: {{ $labels.instance }} \n - job: {{ $labels.job }} : {{ $labels.mountpoint }} 分区使用率大于90% (当前值：{{ $value }})&quot;

  # CPU iowait高于12%
  - alert: node-exporter-cpu-iowait-high
    expr: avg(irate(node_cpu_seconds_total{mode=&quot;iowait&quot;}[15m])) by(instance,job) * 100 &gt; 12
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: &quot;instance: {{ $labels.instance }} CPU iowait 高于15%&quot;
      description: &quot;instance: {{ $labels.instance }} \n - job: {{ $labels.job }} CPU iowait大于15% (当前值：{{ $value }})&quot;

  # 磁盘IO性能高于60%
  - alert: node-exporter-disk-io-high
    expr: avg(irate(node_disk_io_time_seconds_total{device=~&quot;(s|h)d.*&quot;}[15m])) by(instance,job) * 100 &gt; 60
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: &quot;instance: {{ $labels.instance }} : {{ $labels.device }} 磁盘IO高于60%&quot;
      description: &quot;instance: {{ $labels.instance }} \n - job: {{ $labels.job }} ： {{ $labels.device }} 磁盘IO大于60% (当前值：{{ $value }})&quot;

  # TCP timewait数量高于10000
  - alert: node-exporter-tcp-timewait-high
    expr: node_sockstat_TCP_tw &gt; 10000
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: &quot;instance: {{ $labels.instance }} TCP TIME_WAIT数 高于10000&quot;
      description: &quot;instance: {{ $labels.instance }} \n - job: {{ $labels.job }} TCP TIME_WAIT数 大于10000 (当前值：{{ $value }})&quot;
</code></pre>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15839856905581.html"  title="Previous Post: 告警分组、抑制、静默">&laquo; 告警分组、抑制、静默</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15839857094920.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
